const chalk = require('chalk');

import {
  Decision,
  DecoratedApplication,
  OlaDatas,
  ProgramApprovals,
  ProgramDescriptions,
  SmallBusinessStatuses,
  TaxClearanceValues,
} from './types';
import {
  adjustedMarchAprilMay2020Revenue,
  cappedMarchAprilMay2019Revenue,
  flag,
  getApplicantBackground,
  getCapacityOpen,
  getDecision,
  getDesignation,
  getFindingsString,
  getMonitoringStatus,
  getMonitoringType,
  getOwnershipStructure,
  getProductStatusId,
  getProductSubStatusId,
  getQuarterlyWageData,
  getReasonablenessExceptions,
  getReportedRevenueReasonableness,
  getServicingOfficer,
  getTaxClearanceComments,
  getTaxationReportedNetIncomeLoss,
  getTaxationReportedRevenue,
  getTaxationReportedTaxFilingAndYear,
  getTaxationSalesTax2019,
  getTaxationSalesTax2020,
  getWr30ReportingComments,
  getYYRevenueDeclineReasonableness,
  value,
  yesNo,
} from './helpers';
import { bool, formatDate, formatExcelDate } from '../util';

import { Designations } from '../inputs/applications';

export function generateOlaDatas(app: DecoratedApplication, test: boolean): OlaDatas {
  try {
    const olaDatas: OlaDatas = {
      Account: {
        Name: 'Test Hanish 234',
        DoingBusinessAs: '',
        Email: 'fcrdc2@hotmail.com',
        Telephone: '(201) 444-6656',
        WebSiteURL:
          'https://urldefense.com/v3/__http://www.familychiropracorsofridgewod.com__;!!J30X0ZrnC1oQtbA!ZmAtoIUeNrF8ZPQhhFA3UYdkd2EXq0LATdqqQdWnu0E6M1dtF0IRHdT04XgAPGpLow9c$ ',
        YearEstablished: '1987',
        AnnualRevenue: null,
        TaxClearanceComments: TaxClearanceValues.Clear,
        ACHNonCompliance: '',
        address2Line1: '',
        address2Line2: '',
        address2City: '',
        address2Zip: '',
        address2State: '',
        address2County: '',
        address2Country: '',
        WomanOwned: 'Yes',
        VeteranOwned: '',
        MinorityOwned: '',
        DisabilityOwned: '',
        Comment: SmallBusinessStatuses.Yes,
        SSN: '',
      },
      Project: {
        StatusCode: 1,
        ProjectDescription: '',
      },
      Product: {
        DevelopmentOfficer: '',
        ServicingOfficerId: '{834023BA-3ED6-E811-811B-1458D04E2F10}',
        AppReceivedDate: '/Date(1591675200000)/',
        Amount: {
          Value: 15000,
          ExtensionData: null,
        },
        nol_total_NOL_benefit: null,
        nol_total_RD_benefit: null,
        benefit_allocation_factor: null,
        nol_prior_years_tax_credits_sold: null,
        ProductStatusId: '{A23854FF-59F7-E511-80DE-005056AD31F5}',
        ProductSubStatusId: '{0FE1E76F-8359-E611-80D3-005056ADEF6F}',
        ProductTypeId: '{93BA9C04-1B04-EB11-A815-001DD8018831}',
        LocatedInCommercialLocation: '',
        ProductDescription: '',
        lender: '',
        lenderAmount: null,
        lender_address_1: '',
        lender_address_2: '',
        lender_city: '',
        lender_zipcode: '',
        lender_email: '',
        lender_phone: '',
      },
      Underwriting: {
        salutation: '',
        firstName: 'Louise',
        middleName: '',
        lastName: 'DiGia Levenshus',
        suffix: '',
        jobTitle: '',
        address1: '89 N Maple Ave',
        address2: '',
        city: 'Ridgewood Village',
        zipcode: '07450',
        telephone: '2014446656',
        telephoneExt: '',
        email: 'fcrdc2@hotmail.com',
        organizationName: 'Test Hanish 234',
        knownAs: '',
        ein: '222806811',
        naicsCode: '722400',
        ownershipStructure: 'Partnership',
        applicantBackground: '',
        headquarterState: '',
        headquarterCountry: '',
        landAcquisitions: null,
        newBldgConstruction: null,
        acquisitionExistingBuilding: null,
        existingBldgRvnt: null,
        upgradeEquipment: null,
        newEquipment: null,
        usedEquipment: null,
        engineerArchitechFees: null,
        legalFees: null,
        accountingFees: null,
        financeFees: null,
        roadUtilitiesConst: null,
        debtServiceReserve: null,
        constructionInterest: null,
        refinancing: null,
        workingCapital: null,
        otherCost1: null,
        otherCost2: null,
        otherCost3: null,
        otherCost1Description: null,
        otherCost2Description: null,
        otherCost3Description: null,
        counselFirmName: '',
        counselFirstName: '',
        counselLastName: '',
        counselStreetAddress1: '',
        counselStreetAddress2: '',
        counselCity: '',
        counselState: '',
        counselZipCode: '',
        counselPhoneNumber: '',
        counselEmailAddress: '',
        accountantFirmName: '',
        accountantFirstName: '',
        accountantLastName: '',
        accountantStreetAddress1: '',
        accountantStreetAddress2: '',
        accountantCity: '',
        accountantState: '',
        accountantZipCode: '',
        accountantPhoneNumber: '',
        accountantEmailAddress: '',
        totalCost: null,
        applicationID: 'CV19GR7',
        selectedProducts: 'Sustain and Serve NJ',
        ReceivedPreiousFundingFromEDA: '',
        ReceivedPreiousFundingFromOtherthanEDA: '',
        TotalFullTimeEligibleJobs: 2,
        NJFullTimeJobsAtapplication: 0,
        PartTimeJobsAtapplication: 2,
        softCosts: null,
        relocationCosts: null,
        securityCosts: null,
        titleCosts: null,
        surveyCosts: null,
        marketAnalysisCosts: null,
        developmentImpactCosts: null,
        marketSiteCosts: null,
        demolitionCosts: null,
        streetscapeCosts: null,
        remediationCosts: null,
        redemptionPremiumCosts: null,
        installationMachineryCosts: null,
        totalProjectCost: null,
        financeAmtApplied: null,
      },
      Location: {
        isRelocation: null,
        isExpansion: null,
        isStartup: null,
        address1Line1: '89 N Maple Ave',
        address1Line2: '',
        address1City: 'Ridgewood Village',
        address1Zip: '07450',
        address1State: 'NJ',
        address1County: 'Bergen',
        address1Municipality: 'Ridgewood Village',
        address1Country: '',
        block: '',
        lot: '',
        congressionalDistrict: '05',
        legislativeDistrict: '40',
        censusTract: 34003047400,
        Comments: 'Home-Based Business: No',
        EligibleOpportunityZone: 'No',
      },
      FeeRequest: {
        receivedDate: null,
        receivedAmt: null,
        confirmationNum: '',
        productFeeAmount: null,
      },
      Monitoring: {
        Status: 'Completed',
        MonitoringType: 'External',
        Findings: 'Reported Jobs are greater than WR30 Data',
        CompletionDate: '/Date(1592971200000)/',
        GeneralComments: 'Other Workers (1099, seasonal, PEO): 0',
      },
      SSNJRestaurants: [
        {
          Name: 'Restaurant 234',
          DoingBusinessAs: '',
          EIN: '123452356',
          WebSiteURL:
            'https://urldefense.com/v3/__http://www.familychiropracorsofridgewod.com__;!!J30X0ZrnC1oQtbA!ZmAtoIUeNrF8ZPQhhFA3UYdkd2EXq0LATdqqQdWnu0E6M1dtF0IRHdT04XgAPGpLow9c$ ',
          NAICS: '242312',
          SelfIdentifyAs: 'Woman Owned, Disabled Owned',
          ExistsPriorFeb2020: 'Yes',
          FirstName: '',
          LastName: '',
          Title: '',
          Phone: '',
          Cell: '',
          Email: '',
          address1Line1: '89 N Maple Ave',
          address1Line2: '',
          address1City: 'Ridgewood Village',
          address1Zip: '07450',
          address1State: 'NJ',
          address1County: 'Bergen',
          address2Line1: '',
          address2Line2: '',
          address2City: '',
          address2Zip: '',
          address2State: '',
          address2County: '',
          NegativeImpacts: '',
          ExplainNegativeImpacts: '',
          TotalFTECountfromWR30: '',
          Status: 'Declined',
          Findings: '(#1 Decline): DOL NO GO List',
        },
        {
          Name: 'Restaurant 123',
          DoingBusinessAs: '',
          EIN: '34324324',
          WebSiteURL:
            'https://urldefense.com/v3/__http://www.test.com__;!!J30X0ZrnC1oQtbA!ZmAtoIUeNrF8ZPQhhFA3UYdkd2EXq0LATdqqQdWnu0E6M1dtF0IRHdT04XgAPPpuKDbd$ ',
          NAICS: '435345',
          SelfIdentifyAs: 'Woman Owned, Disabled Owned',
          ExistsPriorFeb2020: 'Yes',
          FirstName: '',
          LastName: '',
          Title: '',
          Phone: '',
          Cell: '',
          Email: '',
          address1Line1: '89 N Maple Ave',
          address1Line2: '',
          address1City: 'Ridgewood Village',
          address1Zip: '07450',
          address1State: 'NJ',
          address1County: 'Bergen',
          address2Line1: '',
          address2Line2: '',
          address2City: '',
          address2Zip: '',
          address2State: '',
          address2County: '',
          NegativeImpacts: '',
          ExplainNegativeImpacts: '',
          TotalFTECountfromWR30: '',
          Status: 'In Progress',
          Findings: '(#1 Review): On SAMS List',
        },
      ],
    };

    return olaDatas;
  } catch (e) {
    console.error(chalk.red('DecoratedApplication for the error below:'));
    console.dir(app, { depth: null });
    console.error(
      chalk.red(
        `Error found while generating OLA Datas for application ${app.ApplicationId} (printed above):`
      )
    );
    console.dir(e, { depth: null });

    throw e;
  }
}
